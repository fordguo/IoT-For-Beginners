# 使用传感器和执行器跟物理世界交互

![本课程概述草图](../../../../sketchnotes/lesson-3.jpg)

> Sketchnote by [Nitya Narasimhan](https://github.com/nitya). 单击图像可查看大图。

本课程是[Microsoft Reactor](https://developer.microsoft.com/reactor/?WT.mc_id=academic-17441-jabenn)制作的 [Hello IoT series](https://youtube.com/playlist?list=PLmsFUfdnGr3xRts0TIwyaHyQuHaNQcb6-)的一部分。  该课程以 2 个视频的形式授课 - 1小时的课程和1小时的深入剖析和答疑。

[![Lesson 3: Interact with the Physical World with Sensors and Actuators](https://img.youtube.com/vi/Lqalu1v6aF4/0.jpg)](https://youtu.be/Lqalu1v6aF4)

[![Lesson 3: Interact with the Physical World with Sensors and Actuators - Office hours](https://img.youtube.com/vi/qR3ekcMlLWA/0.jpg)](https://youtu.be/qR3ekcMlLWA)

> 🎥 点击以上图片观看视频教程

## 课前测验

[课前测验](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/5)

## 介绍

本课程为你介绍两个重要的物联网（IoT）设备 - 传感器和执行器。 你也将动手实践它们，为你的物联网工程添加一个光传感器，然后再添加一个光控的LED，这样就有效地构建了一个夜灯。

本课程将涵盖：

* [传感器是什么？](#what-are-sensors)
* [使用传感器](#use-a-sensor)
* [传感器类型](#sensor-types)
* [执行器是什么？](#what-are-actuators)
* [使用执行器](#use-an-actuator)
* [执行器类型](#actuator-types)

## 传感器是什么？

传感器是探测物理世界的硬件设备，它们测量自身周围一个或多个属性并且将这些信息发送到一个物联网设备。传感器涉及的设备范围非常广泛，因为有太多的东西可以被测量，从常见属性比如气温到物理交互比如运动。

常见的一些传感器包括：

* 温度传感器 - 探测气温或者浸泡液体的温度。对业余爱好者和开发者来说，通常将气压和湿度整合到一个传感器中。
* 按钮 - 探测它们何时被按下
* 光传感器 - 探测光强度，也可是特定颜色，比如UV光、IR光或其他可见光
* 相机 - 通过照片或者视频流的方式探测世界的视觉表示
* 加速仪 - 探测多方位的运动
* 麦克风 - 探测声音，包括通常的声级或定向声音。

✅ 做点研究：你的手机有那些传感器？

所有传感器有一个共同点 - 将它们所探测的东西转换成可被物联网设备解释的电子信号。电子信号如何被解释取决于传感器，也取决于用于跟物联网设备通讯的通讯协议。

## 使用传感器

跟随下面相关指导为你的物联网设备添加一个传感器：

* [Arduino - Wio 终端](wio-terminal-sensor.zh-cn.md)
* [单板计算机 - 树莓派](pi-sensor.zh-cn.md)
* [单板计算机 - 虚拟设备](virtual-device-sensor.zh-cn.md)

## 传感器类型

传感器可分为模拟或数字。

###  模拟传感器

最基本的一些传感器是模拟的。此类传感器从物联网设备上接收一个电压，传感器零部件调节这个电压，并且传感器上返回的电压被用来测量给定的传感值。

> 🎓 电压是一个度量单位，用来度量电力从一处到另一处的推动力指标，比如从电池的正极到负极。例如一个标准的AA电池是1.5V(V伏特的符号)，可以以1.5V的力将电从其正极推向负极。不同的电气硬件需要不同的电压才能工作，比如一个LED需要2-3V可以发光，而一个100W的灯丝灯泡则需要240V。你可以在[维基百科-电压页](https://wikipedia.org/wiki/Voltage)中阅读更多关于电压的内容。

电位器就是一个例子。它就是一个可以在两个位置旋转的刻度盘，此传感器测量旋转情况。

![电位器的指针置于接近5伏特的中间并且返回3.8伏特](../../../../images/potentiometer.png)

物联网设备将发送一个电压（比如5V）的电信号给电位器。当电位器调节后，它会改变另一侧的电压。假设你有一个标记刻度从0到 [11](https://wikipedia.org/wiki/Up_to_eleven)的电位器，就像放大器上的一个量调节把手。当电位器在完全0位置时，将输出0V，当完全在11位置时，将输出5V。

> 🎓 这是关于简单化的，你可以在[维基百科电位器页](https://wikipedia.org/wiki/Potentiometer)阅读更多关于电位器和可变电阻器的信息。

传感器输出的电压被物联网设备读取，此设备也能对传感器做出回应。取决于传感器，此电压可以是任意值，也可以映射到一个标准单位。例如一个基于[热敏电阻](https://wikipedia.org/wiki/Thermistor)的模拟的温度传感器，会根据温度改变其电阻。然后输出电压可以被转换成一个开尔文温度，再根据代码计算为相应的 摄氏度（°C） 或华氏度（ °F）。

✅ 如果传感器返回的电压高于发送的（比如来自于一个外部电源），你认为会发生什么？
⛔️ 不要去实验它。

#### 模数转换

物联网设备是数字的 - 它们无法处理模拟值，只能处理0和1。这意味着在处理以前，模拟传感器的值需要被转换成数字信号。许多物联网设备都有模数转换器(ADC)来将模拟的输入转换成其值的数字表示。传感器也可以通过连接器板与ADC配合使用。例如在树莓派的Seeed Grove生态中，模拟传感器连到Pi上的'帽子(hat，跟Pi的GPIO引脚相连)'上的特定端口, 并且此"帽子"有一个ADC将电压转换成可被Pi的GPIO引脚发送的数字信号。

假设你有一个模拟的光传感器用3.3V连到物联网设备上，返回一个1V的值。这个1V在数字世界中没有任何意义，因此需要被转换。 取决于设备和传感器，电压将会按照比例被转换成一个模拟值。Seeed Grove光传感器就是一个例子，其输出值是0到1023。对这个运行于3.3V的传感器来说，1V的输出相当于值是300。物联网设备不能此300以模拟信号值处理，因此通过Grove“帽子”，这个300值将被转换成二进制表示的`0000000100101100`。这样才能被物联网设备所处理。

✅ 如果你不懂二进制，那么请做点少量研究来学习数字是如何用0和1来表示的。 [BBC Bitesize的二进制课程简介](https://www.bbc.co.uk/bitesize/guides/zwsbwmn/revision/1)是一个很好的开始。

从编码的角度看，所有这些通常都被传感器自带的库所处理，因此你自己不需要担心这种转换。对Grove光传感器来说，你将使用Python库，并调用`light`属性即可，或使用Arduino库调用`analogRead`来获取这个300值。

### 数字传感器

数字传感器跟模拟传感器类似，以改变电气电压的方式探测周围世界。其不同点是它们以仅测量两个状态或者使用内置ADC的方式输出一个数字信号。数字传感器正变得原来越普遍，因为不管是在连接器板还是物联网设备自身，它们都可以避免对使用ADC的依赖。

最简单的数字传感器是一个按钮或者开关，这是一种只有两个状态（开或关）的传感器。

![一个发送5伏特的按钮。当没有按下时，其返回0伏特，按下的时候，返回5伏特](../../../../images/button.png)

物联网设备的引脚（比如GPIO引脚）能直接测量此信号为0或1.如果发送的电压跟返回的相同，那读到的值是1，否则就是0。无须再转换此信号，只能是1或0。

> 💁 电压从来都不是精准的，因为传感器内的零件会有一些电阻，因此 通常有一个偏差。例如工作在3.3V的树莓派上的GPIO引脚，将大于1.8V的返回信号读为1，低于1.8V视为0。

* 3.3V有效的按钮。按钮关上，输出0V，给出0值。
* 3.3V有效的按钮。按钮打开，输出3.3V，给出1值。

更高级点的数字传感器读取模拟值，然后利用主板上的ADC将模拟信号转换成数字信号。例如一个数字温度传感器，依旧使用一个跟模拟传感器同样方式的热电偶，并且仍然会测量当前温度下热电偶电阻变化引起的电压变化。取决于设备或者连接器板的转换数字信号，传感器内置的ADC不会返回模拟值，而是会转换此值并将其作为一系列的0和1发送到物联网设备。这些0和1的发送方式跟按钮的数字信号相同，1是全电压，0是0v。

![数字温度传感器在发送到物联网设备以前，将读到的模拟值转换成二进制数据（0伏特为0，5伏特为1）](../../../../images/temperature-as-digital.png)

发送数字数据让传感器变得更复杂，并且发送更详细的数据，甚至是安全传感器的加密数据。相机就是一个例子，它捕捉到一副图像，而包含此图像的数字数据，通常以压缩格式比如JPEG，发送到物联网设备。它甚至捕捉图像成视频流，以逐帧发送完整图像或压缩视频流的方式发送。

## 执行器是什么?

执行器跟传感器相反- 他们将来自物联网设备的电气信号转换成跟物理世界的一个交互，比如发光或发声，或者移动一个马达。

一些常用的执行器包括：

* LED - 当打开的时候，它们发光。
* 扬声器 - 基于送给它们的信号，它们会发出声音，涵盖范围从基本的蜂鸣器到可以播放音乐的喇叭。
* 步进电机  - 它们将信号转换成一个给定的旋转量，比如将表盘旋转90°。
* 继电器 - 它们是可被电气信号打开或关闭的开关。它们可以将来自物联网设备的小电压变成大点的电压。
* 屏幕 - 它们是更复杂的执行器，用于在多区显示器上显示信息。屏幕种类繁多，可以从简单的LED显示到高分辨率的监视器。

✅ 做一些研究，你的手机都有哪些执行器？

## 使用执行器

跟随下面相关指导为你的物联网设备添加一个执行器，构建一个由传感器控制的物联网夜灯。它将从光传感器采集光强度，当检测的光强度过低的时候，会使用LED形式的执行器来发光。

![一个展示读取和检查光强度以及LED开始被控制的任务流程图](../../../../images/assignment-1-flow.png)

* [Arduino - Wio 终端](wio-terminal-actuator.zh-cn.md)
* [单板计算机 - 树莓派](pi-actuator.zh-cn.md)
* [单板计算机 - 虚拟设备](virtual-device-actuator.zh-cn.md)

## 执行器类型

跟传感器一样，执行器也分为模拟和数字两种类型。

### 模拟执行器

模拟执行器取得一个模拟信号，并且将其转换成某种交互，此交互变化是基于其提供的电压。

一个例子就是你家里可能有的可调光灯。提供给灯的电压量决定了它的亮度。

![一个在低电压变暗，高电压变量的灯](../../../../images/dimmable-light.png)

跟传感器一样，实际的物联网设备作用于数字信号而非模拟。这意味着要发送一个模拟信号，物联网设备需要一个数模转换器（DAC），不管是设备自身带的，还是连接器板上的。转换器将会把来自物联网设备的0和1转换成执行器可用的模拟电压。

✅ 如果物联网设备发送一个高出执行器所能承受的电压，你认为会发生什么？
⛔️ 不要去实验它。

#### 脉冲宽度调制（PWM）

将物联网设备的数字信号转换成模拟信号的另外一个选项是脉冲宽度调制。它以发送大量短数字脉冲方式来模拟成一个模拟信号。

例如你可以使用PWM来控制电机的速度。

假设你正在控制一个5V电源的电机，你给你的电机发送一个短脉冲，将电压切换到最高（5V）保持百份之二秒（0.02s），在此同时你的电机可以旋转十分之一圈（36°）。此信号以发送低压（0V）信号方式暂停百份之二秒（0.02s）。每一个这样开、关循环持续0.04s，然后重复这样循环。

![脉冲宽度调制150RPM电机的旋转](../../../../images/pwm-motor-150rpm.png)

这意味着在1秒内，你有25个0.02s的5V脉冲来转动电机，每一个后面有一个0.02s的0V来暂停电机旋转。 每一个脉冲旋转电机十分之一圈，意味着电机每秒转2.5圈。你已经使用数字信号旋转电机，其旋转是每秒2.5转或150 [每分钟转速](https://wikipedia.org/wiki/Revolutions_per_minute) (转速的非标准单位)。

```output
25 脉冲/秒 x 0.1 转/脉冲 = 2.5 转/秒
2.5 转/秒 x 60 秒/分钟  = 150rpm
```

> 🎓 当一个PWM信号是一半时间开，一半时间关，其被称为 [50% 占空比](https://wikipedia.org/wiki/Duty_cycle)。占空比是用来测量信号处于开和关状态下的时间百分比。
![脉冲宽度调制75RPM电机的旋转](../../../../images/pwm-motor-75rpm.png)

你可以通过改变脉冲大小的方式来改变电机的速度。比如同样的电机，保持同样的0.04s的周期循环，但开的脉冲减半到0.01s，而关的脉冲增加到0.03s。你仍有相同的的每秒脉冲数（25），但是每个开的脉冲确实原来的一半。减半的脉冲只能带动电机旋转二十分之一圈，一秒24个脉冲将会完成1.25转/秒（75rpm）。通过数字信号调整脉冲的速度，你可以将模拟电机的速度减半。

```output
25 脉冲/秒 x 0.05 转/脉冲 = 1.25 转/秒
1.25 转/秒 x 60 秒/分钟 = 75rpm
```

✅ 你是如何保持电机平稳旋转，尤其是在低俗的时候？ 你会使用少量的带长暂停的长脉冲，还是大量的带很短暂停的短脉冲？

> 💁 一些传感器也使用PWM来将模拟信号转化成数字信号。

> 🎓 关于脉冲宽度调制，你可以在[维基百科的脉冲宽度调制页](https://wikipedia.org/wiki/Pulse-width_modulation).阅读更多信息。

### 数字执行器

数字执行器同数字传感器类似，都有两个被高或低电压控制的状态，或含有一个内置的用以将数字信号转换成模拟的数模转换器。

LED就是一个简单数字执行器。当一个设备发送一个值是1的数字信号，就会发送一个高电压来点亮LED。当一个值是0的数字信号发送后，电压就下降到0V，并且LED关闭。

![一个LED在0V关闭，在5V打开](../../../../images/led.png)

✅ 你能想到的其他简单双态执行器是什么？螺线管就是一个示例，它以激活电磁的方式来做事，比如移动门栓来锁定或解锁门。

更多高级数字执行器，例如需要特定数字数据格式的屏幕。它们通常附带开发库来轻松发送正确的数据，用以控制这些设备。

---

## 🚀 挑战

最近两节课的挑战是在你家里、学校或者工作场所列出尽可能多的物联网设备，并且裁定它们是基于微控制器还是单板计算机，亦或是两者的混合。

你所罗列的每一个设备中，是连接到什么样的传感器和执行器？连接到这些设备上的每一个传感器和执行器，其作用是什么？

## 课后测验

[课后测验](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/6)

## 复习和自学

* 研读[ThingLearn](http://thinglearn.jenlooper.com/curriculum/)的关于电学和电路.
* 阅读[Seeed Studios Temperature Sensors guide](https://www.seeedstudio.com/blog/2019/10/14/temperature-sensors-for-arduino-projects/)中关于温度传感器的不同类型
* 阅读 [维基百科LED页面](https://wikipedia.org/wiki/Light-emitting_diode)中关于LED

## 作业

[调研传感器和执行器](assignment.zh-cn.md)
